<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç·’è¾¨è­˜äº’å‹•ç¶²é </title>
    <style>
        body {
            background-color: #222;
            color: white;
            text-align: center;
            font-family: "Microsoft JhengHei", sans-serif;
            margin: 0;
            padding: 0;
        }
        h1 { margin-top: 20px; color: #FFD700; }
        
        .video-container {
            margin: 20px auto;
            border: 5px solid #fff;
            border-radius: 10px;
            display: inline-block;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            position: relative;
            max-width: 90%;
        }
        
        img#live-stream { 
            display: block; 
            width: 640px; 
            max-width: 100%; 
            height: auto;
        }
        
        p { font-size: 1.2rem; opacity: 0.8; }

        /* === é—œéµä¿®æ­£ï¼šæˆªåœ–å±•ç¤ºé®ç½©å±¤ === */
        #snapshot-overlay {
            display: none; /* é è¨­éš±è— */
            position: fixed; /* å›ºå®šåœ¨è¦–çª—ä¸Šï¼Œä¸éš¨æ²è»¸ç§»å‹• */
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* æ·±è‰²åŠé€æ˜èƒŒæ™¯ */
            z-index: 9999; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
            justify-content: center; /* æ°´å¹³ç½®ä¸­ */
            align-items: center; /* å‚ç›´ç½®ä¸­ */
            flex-direction: column; /* ç›´å‘æ’åˆ— */
        }

        /* ç•¶ JavaScript åŠ ä¸Š .show é¡åˆ¥æ™‚ï¼Œåˆ‡æ›æˆé¡¯ç¤ºæ¨¡å¼ */
        #snapshot-overlay.show {
            display: flex; 
            animation: fadeIn 0.3s ease-in-out;
        }

        #snapshot-img {
            max-width: 80vw; /* æœ€å¤§å¯¬åº¦è¦–çª—çš„ 80% */
            max-height: 80vh; /* æœ€å¤§é«˜åº¦è¦–çª—çš„ 80% */
            border: 5px solid #FFD700; /* é‡‘è‰²é‚Šæ¡† */
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            border-radius: 10px;
            object-fit: contain;
        }
        
        #snapshot-overlay p {
            margin-top: 20px; 
            color: #FFD700; 
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        @keyframes fadeIn { 
            from { opacity: 0; transform: scale(0.9); } 
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>

    <h1>ğŸ­ AI æƒ…ç·’äº’å‹•é¡é ­</h1>
    <p>è©¦è‘—å°é¡é ­åšå‡ºä¸åŒè¡¨æƒ…ï¼ŒæŒ‰ä¸‹ <b>"S"</b> éµå¯ä»¥æˆªåœ–ï¼</p>

    <div class="video-container">
        <img id="live-stream" src="{{ url_for('video_feed') }}" alt="Video Stream">
    </div>

    <div id="snapshot-overlay">
        <img id="snapshot-img" src="" alt="Screenshot Result">
        <p>âœ¨ æˆªåœ–æˆåŠŸï¼(3ç§’å¾Œé—œé–‰)</p>
    </div>

    <script>
        let snapshotTimeout; // ç”¨ä¾†å­˜æ”¾è¨ˆæ™‚å™¨

        // ç›£è½å…¨åŸŸéµç›¤äº‹ä»¶
        document.addEventListener('keydown', function(event) {
            // åªæœ‰æŒ‰ä¸‹ s æˆ– S æ‰æœƒè§¸ç™¼
            if (event.key === 's' || event.key === 'S') {
                console.log("åµæ¸¬åˆ° S éµï¼Œæº–å‚™æˆªåœ–...");
                takeSnapshot();
            }
        });

        function takeSnapshot() {
            fetch('/snapshot')
                .then(response => response.json())
                .then(data => {
                    // æª¢æŸ¥å¾Œç«¯æ˜¯å¦å›å‚³æˆåŠŸ
                    if (data.status === 'success') {
                        console.log('æˆªåœ–å„²å­˜æˆåŠŸ:', data.filename);
                        // å‘¼å«é¡¯ç¤ºå‡½å¼
                        showSnapshotResult(data.filename);
                    } else {
                        console.error('æˆªåœ–å¤±æ•—:', data.message);
                    }
                })
                .catch(error => console.error('è«‹æ±‚éŒ¯èª¤:', error));
        }

        // é¡¯ç¤ºæˆªåœ–çµæœçš„å‡½å¼
        function showSnapshotResult(filename) {
            const overlay = document.getElementById('snapshot-overlay');
            const img = document.getElementById('snapshot-img');

            // 1. è¨­å®šåœ–ç‰‡è·¯å¾‘
            // é€™é‚Šæœƒå»è«‹æ±‚å¾Œç«¯çš„ /snapshots/<filename>
            img.src = "/snapshots/" + filename;

            // 2. é¡¯ç¤ºé®ç½©å±¤
            overlay.classList.add('show');

            // 3. æ¸…é™¤èˆŠçš„è¨ˆæ™‚å™¨ (é˜²æ­¢å¿«é€Ÿé€£æŒ‰æ™‚é–ƒçˆ)
            if (snapshotTimeout) clearTimeout(snapshotTimeout);

            // 4. è¨­å®š 3 ç§’å¾Œè‡ªå‹•éš±è—
            snapshotTimeout = setTimeout(() => {
                overlay.classList.remove('show');
                // å»¶é²ä¸€é»é»å†æ¸…ç©º srcï¼Œé¿å…ç•«é¢é–ƒçˆ
                setTimeout(() => { img.src = ""; }, 300);
            }, 3000);
        }
    </script>

</body>
</html>